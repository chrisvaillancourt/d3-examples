!async function(){let t=await d3.json("../data/nyc_weather_data.json");const e=t=>t.temperatureMax,a=d3.timeParse("%Y-%m-%d"),n=t=>a(t.date);t=t.sort((t,e)=>n(t)-n(e)).slice(0,100);let i={width:.9*window.innerWidth,height:400,margin:{top:15,right:15,bottom:40,left:60}};i.boundedWidth=i.width-i.margin.left-i.margin.right,i.boundedHeight=i.height-i.margin.top-i.margin.bottom;const d=d3.select("#wrapper").append("svg").attr("width",i.width).attr("height",i.height).append("g").style("transform",`translate(${i.margin.left}px, ${i.margin.top}px)`);d.append("defs").append("clipPath").attr("id","bounds-clip-path").append("rect").attr("width",i.boundedWidth).attr("height",i.boundedHeight),d.append("rect").attr("class","freezing"),d.append("g").attr("clip-path","url(#bounds-clip-path)").append("path").attr("class","line"),d.append("path").attr("class","line"),d.append("g").attr("class","x-axis").style("transform",`translateY(${i.boundedHeight}px)`),d.append("g").attr("class","y-axis");const r=t=>{const a=d3.scaleLinear().domain(d3.extent(t,e)).range([i.boundedHeight,0]),r=a(32),s=(d.select(".freezing").attr("x",0).attr("width",i.boundedWidth).attr("y",r).attr("height",i.boundedHeight-r),d3.scaleTime().domain(d3.extent(t.slice(2),n)).range([0,i.boundedWidth])),o=d3.line().x(t=>s(n(t))).y(t=>a(e(t)));var l=t.slice(-2),p=s(n(l[1]))-s(n(l[0]));d.select(".line").attr("d",o(t)).style("transform",`translateX(${p}px)`).transition().duration(1e3).style("transform","none");const h=d3.axisLeft().scale(a),c=(d.select(".y-axis").call(h),d3.axisBottom().scale(s));d.select(".x-axis").transition().duration(1e3).call(c)};function s(t){const a=t[t.length-1],i=d3.timeDay.offset(n(a),1);return{date:d3.timeFormat("%Y-%m-%d")(i),temperatureMax:e(a)+(6*Math.random()-3)}}r(t),setInterval((function(){t=[...t.slice(1),s(t)],r(t)}),1500)}();
