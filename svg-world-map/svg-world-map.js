import"../index-96966b36.js";import{j as n,s as t,g as r}from"../precisionRound-f61f2560.js";import{e as i,l as e}from"../linear-a578dc11.js";var o={},u={};function a(n){return new Function("d","return {"+n.map((function(n,t){return JSON.stringify(n)+": d["+t+'] || ""'})).join(",")+"}")}function c(n){var t=Object.create(null),r=[];return n.forEach((function(n){for(var i in n)i in t||r.push(t[i]=i)})),r}function l(n,t){var r=n+"",i=r.length;return i<t?new Array(t-i+1).join(0)+r:r}function f(n){var t,r=n.getUTCHours(),i=n.getUTCMinutes(),e=n.getUTCSeconds(),o=n.getUTCMilliseconds();return isNaN(n)?"Invalid Date":((t=n.getUTCFullYear())<0?"-"+l(-t,6):t>9999?"+"+l(t,6):l(t,4))+"-"+l(n.getUTCMonth()+1,2)+"-"+l(n.getUTCDate(),2)+(o?"T"+l(r,2)+":"+l(i,2)+":"+l(e,2)+"."+l(o,3)+"Z":e?"T"+l(r,2)+":"+l(i,2)+":"+l(e,2)+"Z":i||r?"T"+l(r,2)+":"+l(i,2)+"Z":"")}var s=function(n){var t=new RegExp('["'+n+"\n\r]"),r=n.charCodeAt(0);function i(n,t){var i,e=[],a=n.length,c=0,l=0,f=a<=0,s=!1;function p(){if(f)return u;if(s)return s=!1,o;var t,i,e=c;if(34===n.charCodeAt(e)){for(;c++<a&&34!==n.charCodeAt(c)||34===n.charCodeAt(++c););return(t=c)>=a?f=!0:10===(i=n.charCodeAt(c++))?s=!0:13===i&&(s=!0,10===n.charCodeAt(c)&&++c),n.slice(e+1,t-1).replace(/""/g,'"')}for(;c<a;){if(10===(i=n.charCodeAt(t=c++)))s=!0;else if(13===i)s=!0,10===n.charCodeAt(c)&&++c;else if(i!==r)continue;return n.slice(e,t)}return f=!0,n.slice(e,a)}for(10===n.charCodeAt(a-1)&&--a,13===n.charCodeAt(a-1)&&--a;(i=p())!==u;){for(var h=[];i!==o&&i!==u;)h.push(i),i=p();t&&null==(h=t(h,l++))||e.push(h)}return e}function e(t,r){return t.map((function(t){return r.map((function(n){return s(t[n])})).join(n)}))}function l(t){return t.map(s).join(n)}function s(n){return null==n?"":n instanceof Date?f(n):t.test(n+="")?'"'+n.replace(/"/g,'""')+'"':n}return{parse:function(n,t){var r,e,o=i(n,(function(n,i){if(r)return r(n,i-1);e=n,r=t?function(n,t){var r=a(n);return function(i,e){return t(r(i),e,n)}}(n,t):a(n)}));return o.columns=e||[],o},parseRows:i,format:function(t,r){return null==r&&(r=c(t)),[r.map(s).join(n)].concat(e(t,r)).join("\n")},formatBody:function(n,t){return null==t&&(t=c(n)),e(n,t).join("\n")},formatRows:function(n){return n.map(l).join("\n")},formatRow:l,formatValue:s}}(",").parse;function p(n){if(!n.ok)throw new Error(n.status+" "+n.statusText);return n.text()}function h(n,t){return fetch(n,t).then(p)}var d,g=(d=s,function(n,t,r){return 2===arguments.length&&"function"==typeof t&&(r=t,t=void 0),h(n,t).then((function(n){return d(n,r)}))});function v(){return new y}function y(){this.reset()}y.prototype={constructor:y,reset:function(){this.s=this.t=0},add:function(n){S(m,n,this.t),S(this,m.s,this.s),this.s?this.t+=m.t:this.s=m.t},valueOf:function(){return this.s}};var m=new y;function S(n,t,r){var i=n.s=t+r,e=i-t,o=i-e;n.t=t-o+(r-e)}var E=1e-6,x=Math.PI,M=x/2,_=x/4,w=2*x,N=180/x,j=x/180,C=Math.abs,b=Math.atan,A=Math.atan2,T=Math.cos,P=Math.ceil,R=Math.sin,k=Math.sign||function(n){return n>0?1:n<0?-1:0},U=Math.sqrt;function z(n){return n>1?M:n<-1?-M:Math.asin(n)}function H(){}function L(n,t){n&&W.hasOwnProperty(n.type)&&W[n.type](n,t)}var O={Feature:function(n,t){L(n.geometry,t)},FeatureCollection:function(n,t){for(var r=n.features,i=-1,e=r.length;++i<e;)L(r[i].geometry,t)}},W={Sphere:function(n,t){t.sphere()},Point:function(n,t){n=n.coordinates,t.point(n[0],n[1],n[2])},MultiPoint:function(n,t){for(var r=n.coordinates,i=-1,e=r.length;++i<e;)n=r[i],t.point(n[0],n[1],n[2])},LineString:function(n,t){$(n.coordinates,t,0)},MultiLineString:function(n,t){for(var r=n.coordinates,i=-1,e=r.length;++i<e;)$(r[i],t,0)},Polygon:function(n,t){D(n.coordinates,t)},MultiPolygon:function(n,t){for(var r=n.coordinates,i=-1,e=r.length;++i<e;)D(r[i],t)},GeometryCollection:function(n,t){for(var r=n.geometries,i=-1,e=r.length;++i<e;)L(r[i],t)}};function $(n,t,r){var i,e=-1,o=n.length-r;for(t.lineStart();++e<o;)i=n[e],t.point(i[0],i[1],i[2]);t.lineEnd()}function D(n,t){var r=-1,i=n.length;for(t.polygonStart();++r<i;)$(n[r],t,1);t.polygonEnd()}function F(n,t){n&&O.hasOwnProperty(n.type)?O[n.type](n,t):L(n,t)}function Z(n){return[A(n[1],n[0]),z(n[2])]}function G(n){var t=n[0],r=n[1],i=T(r);return[i*T(t),i*R(t),R(r)]}function I(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]}function Y(n,t){return[n[1]*t[2]-n[2]*t[1],n[2]*t[0]-n[0]*t[2],n[0]*t[1]-n[1]*t[0]]}function q(n,t){n[0]+=t[0],n[1]+=t[1],n[2]+=t[2]}function B(n,t){return[n[0]*t,n[1]*t,n[2]*t]}function J(n){var t=U(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);n[0]/=t,n[1]/=t,n[2]/=t}function V(n,t){function r(r,i){return r=n(r,i),t(r[0],r[1])}return n.invert&&t.invert&&(r.invert=function(r,i){return(r=t.invert(r,i))&&n.invert(r[0],r[1])}),r}function X(n,t){return[C(n)>x?n+Math.round(-n/w)*w:n,t]}function K(n){return function(t,r){return[(t+=n)>x?t-w:t<-x?t+w:t,r]}}function Q(n){var t=K(n);return t.invert=K(-n),t}function nn(n,t){var r=T(n),i=R(n),e=T(t),o=R(t);function u(n,t){var u=T(t),a=T(n)*u,c=R(n)*u,l=R(t),f=l*r+a*i;return[A(c*e-f*o,a*r-l*i),z(f*e+c*o)]}return u.invert=function(n,t){var u=T(t),a=T(n)*u,c=R(n)*u,l=R(t),f=l*e-c*o;return[A(c*e+l*o,a*r+f*i),z(f*r-a*i)]},u}function tn(n,t){(t=G(t))[0]-=n,J(t);var r,i=(r=-t[1])>1?0:r<-1?x:Math.acos(r);return((-t[2]<0?-i:i)+w-E)%w}function rn(){var n,t=[];return{point:function(t,r,i){n.push([t,r,i])},lineStart:function(){t.push(n=[])},lineEnd:H,rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))},result:function(){var r=t;return t=[],n=null,r}}}function en(n,t){return C(n[0]-t[0])<E&&C(n[1]-t[1])<E}function on(n,t,r,i){this.x=n,this.z=t,this.o=r,this.e=i,this.v=!1,this.n=this.p=null}function un(n,t,r,i,e){var o,u,a=[],c=[];if(n.forEach((function(n){if(!((t=n.length-1)<=0)){var t,r,i=n[0],u=n[t];if(en(i,u)){if(!i[2]&&!u[2]){for(e.lineStart(),o=0;o<t;++o)e.point((i=n[o])[0],i[1]);return void e.lineEnd()}u[0]+=2e-6}a.push(r=new on(i,n,null,!0)),c.push(r.o=new on(i,null,r,!1)),a.push(r=new on(u,n,null,!1)),c.push(r.o=new on(u,null,r,!0))}})),a.length){for(c.sort(t),an(a),an(c),o=0,u=c.length;o<u;++o)c[o].e=r=!r;for(var l,f,s=a[0];;){for(var p=s,h=!0;p.v;)if((p=p.n)===s)return;l=p.z,e.lineStart();do{if(p.v=p.o.v=!0,p.e){if(h)for(o=0,u=l.length;o<u;++o)e.point((f=l[o])[0],f[1]);else i(p.x,p.n.x,1,e);p=p.n}else{if(h)for(l=p.p.z,o=l.length-1;o>=0;--o)e.point((f=l[o])[0],f[1]);else i(p.x,p.p.x,-1,e);p=p.p}l=(p=p.o).z,h=!h}while(!p.v);e.lineEnd()}}}function an(n){if(t=n.length){for(var t,r,i=0,e=n[0];++i<t;)e.n=r=n[i],r.p=e,e=r;e.n=r=n[0],r.p=e}}X.invert=X;var cn=v();function ln(n){return C(n[0])<=x?n[0]:k(n[0])*((C(n[0])+x)%w-x)}function fn(n,t){return n<t?-1:n>t?1:n>=t?0:NaN}var sn,pn;1===(sn=fn).length&&(pn=sn,sn=function(n,t){return fn(pn(n),t)});function hn(n,t,r){n=+n,t=+t,r=(e=arguments.length)<2?(t=n,n=0,1):e<3?1:+r;for(var i=-1,e=0|Math.max(0,Math.ceil((t-n)/r)),o=new Array(e);++i<e;)o[i]=n+i*r;return o}function dn(n){for(var t,r,i,e=n.length,o=-1,u=0;++o<e;)u+=n[o].length;for(r=new Array(u);--e>=0;)for(t=(i=n[e]).length;--t>=0;)r[--u]=i[t];return r}function gn(n,t,r,i){return function(e){var o,u,a,c=t(e),l=rn(),f=t(l),s=!1,p={point:h,lineStart:g,lineEnd:v,polygonStart:function(){p.point=y,p.lineStart=m,p.lineEnd=S,u=[],o=[]},polygonEnd:function(){p.point=h,p.lineStart=g,p.lineEnd=v,u=dn(u);var n=function(n,t){var r=ln(t),i=t[1],e=R(i),o=[R(r),-T(r),0],u=0,a=0;cn.reset(),1===e?i=M+E:-1===e&&(i=-M-E);for(var c=0,l=n.length;c<l;++c)if(s=(f=n[c]).length)for(var f,s,p=f[s-1],h=ln(p),d=p[1]/2+_,g=R(d),v=T(d),y=0;y<s;++y,h=S,g=j,v=C,p=m){var m=f[y],S=ln(m),N=m[1]/2+_,j=R(N),C=T(N),b=S-h,P=b>=0?1:-1,k=P*b,U=k>x,H=g*j;if(cn.add(A(H*P*R(k),v*C+H*T(k))),u+=U?b+P*w:b,U^h>=r^S>=r){var L=Y(G(p),G(m));J(L);var O=Y(o,L);J(O);var W=(U^b>=0?-1:1)*z(O[2]);(i>W||i===W&&(L[0]||L[1]))&&(a+=U^b>=0?1:-1)}}return(u<-E||u<E&&cn<-E)^1&a}(o,i);u.length?(s||(e.polygonStart(),s=!0),un(u,yn,n,r,e)):n&&(s||(e.polygonStart(),s=!0),e.lineStart(),r(null,null,1,e),e.lineEnd()),s&&(e.polygonEnd(),s=!1),u=o=null},sphere:function(){e.polygonStart(),e.lineStart(),r(null,null,1,e),e.lineEnd(),e.polygonEnd()}};function h(t,r){n(t,r)&&e.point(t,r)}function d(n,t){c.point(n,t)}function g(){p.point=d,c.lineStart()}function v(){p.point=h,c.lineEnd()}function y(n,t){a.push([n,t]),f.point(n,t)}function m(){f.lineStart(),a=[]}function S(){y(a[0][0],a[0][1]),f.lineEnd();var n,t,r,i,c=f.clean(),p=l.result(),h=p.length;if(a.pop(),o.push(a),a=null,h)if(1&c){if((t=(r=p[0]).length-1)>0){for(s||(e.polygonStart(),s=!0),e.lineStart(),n=0;n<t;++n)e.point((i=r[n])[0],i[1]);e.lineEnd()}}else h>1&&2&c&&p.push(p.pop().concat(p.shift())),u.push(p.filter(vn))}return p}}function vn(n){return n.length>1}function yn(n,t){return((n=n.x)[0]<0?n[1]-M-E:M-n[1])-((t=t.x)[0]<0?t[1]-M-E:M-t[1])}var mn=gn((function(){return!0}),(function(n){var t,r=NaN,i=NaN,e=NaN;return{lineStart:function(){n.lineStart(),t=1},point:function(o,u){var a=o>0?x:-x,c=C(o-r);C(c-x)<E?(n.point(r,i=(i+u)/2>0?M:-M),n.point(e,i),n.lineEnd(),n.lineStart(),n.point(a,i),n.point(o,i),t=0):e!==a&&c>=x&&(C(r-e)<E&&(r-=e*E),C(o-a)<E&&(o-=a*E),i=function(n,t,r,i){var e,o,u=R(n-r);return C(u)>E?b((R(t)*(o=T(i))*R(r)-R(i)*(e=T(t))*R(n))/(e*o*u)):(t+i)/2}(r,i,o,u),n.point(e,i),n.lineEnd(),n.lineStart(),n.point(a,i),t=0),n.point(r=o,i=u),e=a},lineEnd:function(){n.lineEnd(),r=i=NaN},clean:function(){return 2-t}}}),(function(n,t,r,i){var e;if(null==n)e=r*M,i.point(-x,e),i.point(0,e),i.point(x,e),i.point(x,0),i.point(x,-e),i.point(0,-e),i.point(-x,-e),i.point(-x,0),i.point(-x,e);else if(C(n[0]-t[0])>E){var o=n[0]<t[0]?x:-x;e=r*o/2,i.point(-o,e),i.point(0,e),i.point(o,e)}else i.point(t[0],t[1])}),[-x,-M]);function Sn(n){var t=T(n),r=6*j,i=t>0,e=C(t)>E;function o(n,r){return T(n)*T(r)>t}function u(n,r,i){var e=[1,0,0],o=Y(G(n),G(r)),u=I(o,o),a=o[0],c=u-a*a;if(!c)return!i&&n;var l=t*u/c,f=-t*a/c,s=Y(e,o),p=B(e,l);q(p,B(o,f));var h=s,d=I(p,h),g=I(h,h),v=d*d-g*(I(p,p)-1);if(!(v<0)){var y=U(v),m=B(h,(-d-y)/g);if(q(m,p),m=Z(m),!i)return m;var S,M=n[0],_=r[0],w=n[1],N=r[1];_<M&&(S=M,M=_,_=S);var j=_-M,b=C(j-x)<E;if(!b&&N<w&&(S=w,w=N,N=S),b||j<E?b?w+N>0^m[1]<(C(m[0]-M)<E?w:N):w<=m[1]&&m[1]<=N:j>x^(M<=m[0]&&m[0]<=_)){var A=B(h,(-d+y)/g);return q(A,p),[m,Z(A)]}}}function a(t,r){var e=i?n:x-n,o=0;return t<-e?o|=1:t>e&&(o|=2),r<-e?o|=4:r>e&&(o|=8),o}return gn(o,(function(n){var t,r,c,l,f;return{lineStart:function(){l=c=!1,f=1},point:function(s,p){var h,d=[s,p],g=o(s,p),v=i?g?0:a(s,p):g?a(s+(s<0?x:-x),p):0;if(!t&&(l=c=g)&&n.lineStart(),g!==c&&(!(h=u(t,d))||en(t,h)||en(d,h))&&(d[2]=1),g!==c)f=0,g?(n.lineStart(),h=u(d,t),n.point(h[0],h[1])):(h=u(t,d),n.point(h[0],h[1],2),n.lineEnd()),t=h;else if(e&&t&&i^g){var y;v&r||!(y=u(d,t,!0))||(f=0,i?(n.lineStart(),n.point(y[0][0],y[0][1]),n.point(y[1][0],y[1][1]),n.lineEnd()):(n.point(y[1][0],y[1][1]),n.lineEnd(),n.lineStart(),n.point(y[0][0],y[0][1],3)))}!g||t&&en(t,d)||n.point(d[0],d[1]),t=d,c=g,r=v},lineEnd:function(){c&&n.lineEnd(),t=null},clean:function(){return f|(l&&c)<<1}}}),(function(t,i,e,o){!function(n,t,r,i,e,o){if(r){var u=T(t),a=R(t),c=i*r;null==e?(e=t+i*w,o=t-c/2):(e=tn(u,e),o=tn(u,o),(i>0?e<o:e>o)&&(e+=i*w));for(var l,f=e;i>0?f>o:f<o;f-=c)l=Z([u,-a*T(f),-a*R(f)]),n.point(l[0],l[1])}}(o,n,r,e,t,i)}),i?[0,-n]:[-x,n-x])}function En(n,t,r,i){function e(e,o){return n<=e&&e<=r&&t<=o&&o<=i}function o(e,o,a,l){var f=0,s=0;if(null==e||(f=u(e,a))!==(s=u(o,a))||c(e,o)<0^a>0)do{l.point(0===f||3===f?n:r,f>1?i:t)}while((f=(f+a+4)%4)!==s);else l.point(o[0],o[1])}function u(i,e){return C(i[0]-n)<E?e>0?0:3:C(i[0]-r)<E?e>0?2:1:C(i[1]-t)<E?e>0?1:0:e>0?3:2}function a(n,t){return c(n.x,t.x)}function c(n,t){var r=u(n,1),i=u(t,1);return r!==i?r-i:0===r?t[1]-n[1]:1===r?n[0]-t[0]:2===r?n[1]-t[1]:t[0]-n[0]}return function(u){var c,l,f,s,p,h,d,g,v,y,m,S=u,E=rn(),x={point:M,lineStart:function(){x.point=_,l&&l.push(f=[]);y=!0,v=!1,d=g=NaN},lineEnd:function(){c&&(_(s,p),h&&v&&E.rejoin(),c.push(E.result()));x.point=M,v&&S.lineEnd()},polygonStart:function(){S=E,c=[],l=[],m=!0},polygonEnd:function(){var t=function(){for(var t=0,r=0,e=l.length;r<e;++r)for(var o,u,a=l[r],c=1,f=a.length,s=a[0],p=s[0],h=s[1];c<f;++c)o=p,u=h,s=a[c],p=s[0],h=s[1],u<=i?h>i&&(p-o)*(i-u)>(h-u)*(n-o)&&++t:h<=i&&(p-o)*(i-u)<(h-u)*(n-o)&&--t;return t}(),r=m&&t,e=(c=dn(c)).length;(r||e)&&(u.polygonStart(),r&&(u.lineStart(),o(null,null,1,u),u.lineEnd()),e&&un(c,a,t,o,u),u.polygonEnd());S=u,c=l=f=null}};function M(n,t){e(n,t)&&S.point(n,t)}function _(o,u){var a=e(o,u);if(l&&f.push([o,u]),y)s=o,p=u,h=a,y=!1,a&&(S.lineStart(),S.point(o,u));else if(a&&v)S.point(o,u);else{var c=[d=Math.max(-1e9,Math.min(1e9,d)),g=Math.max(-1e9,Math.min(1e9,g))],E=[o=Math.max(-1e9,Math.min(1e9,o)),u=Math.max(-1e9,Math.min(1e9,u))];!function(n,t,r,i,e,o){var u,a=n[0],c=n[1],l=0,f=1,s=t[0]-a,p=t[1]-c;if(u=r-a,s||!(u>0)){if(u/=s,s<0){if(u<l)return;u<f&&(f=u)}else if(s>0){if(u>f)return;u>l&&(l=u)}if(u=e-a,s||!(u<0)){if(u/=s,s<0){if(u>f)return;u>l&&(l=u)}else if(s>0){if(u<l)return;u<f&&(f=u)}if(u=i-c,p||!(u>0)){if(u/=p,p<0){if(u<l)return;u<f&&(f=u)}else if(p>0){if(u>f)return;u>l&&(l=u)}if(u=o-c,p||!(u<0)){if(u/=p,p<0){if(u>f)return;u>l&&(l=u)}else if(p>0){if(u<l)return;u<f&&(f=u)}return l>0&&(n[0]=a+l*s,n[1]=c+l*p),f<1&&(t[0]=a+f*s,t[1]=c+f*p),!0}}}}}(c,E,n,t,r,i)?a&&(S.lineStart(),S.point(o,u),m=!1):(v||(S.lineStart(),S.point(c[0],c[1])),S.point(E[0],E[1]),a||S.lineEnd(),m=!1)}d=o,g=u,v=a}return x}}function xn(n,t,r){var i=hn(n,t-E,r).concat(t);return function(n){return i.map((function(t){return[n,t]}))}}function Mn(n,t,r){var i=hn(n,t-E,r).concat(t);return function(n){return i.map((function(t){return[t,n]}))}}function _n(){return function(){var n,t,r,i,e,o,u,a,c,l,f,s,p=10,h=p,d=90,g=360,v=2.5;function y(){return{type:"MultiLineString",coordinates:m()}}function m(){return hn(P(i/d)*d,r,d).map(f).concat(hn(P(a/g)*g,u,g).map(s)).concat(hn(P(t/p)*p,n,p).filter((function(n){return C(n%d)>E})).map(c)).concat(hn(P(o/h)*h,e,h).filter((function(n){return C(n%g)>E})).map(l))}return y.lines=function(){return m().map((function(n){return{type:"LineString",coordinates:n}}))},y.outline=function(){return{type:"Polygon",coordinates:[f(i).concat(s(u).slice(1),f(r).reverse().slice(1),s(a).reverse().slice(1))]}},y.extent=function(n){return arguments.length?y.extentMajor(n).extentMinor(n):y.extentMinor()},y.extentMajor=function(n){return arguments.length?(i=+n[0][0],r=+n[1][0],a=+n[0][1],u=+n[1][1],i>r&&(n=i,i=r,r=n),a>u&&(n=a,a=u,u=n),y.precision(v)):[[i,a],[r,u]]},y.extentMinor=function(r){return arguments.length?(t=+r[0][0],n=+r[1][0],o=+r[0][1],e=+r[1][1],t>n&&(r=t,t=n,n=r),o>e&&(r=o,o=e,e=r),y.precision(v)):[[t,o],[n,e]]},y.step=function(n){return arguments.length?y.stepMajor(n).stepMinor(n):y.stepMinor()},y.stepMajor=function(n){return arguments.length?(d=+n[0],g=+n[1],y):[d,g]},y.stepMinor=function(n){return arguments.length?(p=+n[0],h=+n[1],y):[p,h]},y.precision=function(p){return arguments.length?(v=+p,c=xn(o,e,90),l=Mn(t,n,v),f=xn(a,u,90),s=Mn(i,r,v),y):v},y.extentMajor([[-180,-89.999999],[180,89.999999]]).extentMinor([[-180,-80.000001],[180,80.000001]])}()()}function wn(n){return n}var Nn,jn,Cn,bn,An=v(),Tn=v(),Pn={point:H,lineStart:H,lineEnd:H,polygonStart:function(){Pn.lineStart=Rn,Pn.lineEnd=zn},polygonEnd:function(){Pn.lineStart=Pn.lineEnd=Pn.point=H,An.add(C(Tn)),Tn.reset()},result:function(){var n=An/2;return An.reset(),n}};function Rn(){Pn.point=kn}function kn(n,t){Pn.point=Un,Nn=Cn=n,jn=bn=t}function Un(n,t){Tn.add(bn*n-Cn*t),Cn=n,bn=t}function zn(){Un(Nn,jn)}var Hn=1/0,Ln=Hn,On=-Hn,Wn=On,$n={point:function(n,t){n<Hn&&(Hn=n);n>On&&(On=n);t<Ln&&(Ln=t);t>Wn&&(Wn=t)},lineStart:H,lineEnd:H,polygonStart:H,polygonEnd:H,result:function(){var n=[[Hn,Ln],[On,Wn]];return On=Wn=-(Ln=Hn=1/0),n}};var Dn,Fn,Zn,Gn,In=0,Yn=0,qn=0,Bn=0,Jn=0,Vn=0,Xn=0,Kn=0,Qn=0,nt={point:tt,lineStart:rt,lineEnd:ot,polygonStart:function(){nt.lineStart=ut,nt.lineEnd=at},polygonEnd:function(){nt.point=tt,nt.lineStart=rt,nt.lineEnd=ot},result:function(){var n=Qn?[Xn/Qn,Kn/Qn]:Vn?[Bn/Vn,Jn/Vn]:qn?[In/qn,Yn/qn]:[NaN,NaN];return In=Yn=qn=Bn=Jn=Vn=Xn=Kn=Qn=0,n}};function tt(n,t){In+=n,Yn+=t,++qn}function rt(){nt.point=it}function it(n,t){nt.point=et,tt(Zn=n,Gn=t)}function et(n,t){var r=n-Zn,i=t-Gn,e=U(r*r+i*i);Bn+=e*(Zn+n)/2,Jn+=e*(Gn+t)/2,Vn+=e,tt(Zn=n,Gn=t)}function ot(){nt.point=tt}function ut(){nt.point=ct}function at(){lt(Dn,Fn)}function ct(n,t){nt.point=lt,tt(Dn=Zn=n,Fn=Gn=t)}function lt(n,t){var r=n-Zn,i=t-Gn,e=U(r*r+i*i);Bn+=e*(Zn+n)/2,Jn+=e*(Gn+t)/2,Vn+=e,Xn+=(e=Gn*n-Zn*t)*(Zn+n),Kn+=e*(Gn+t),Qn+=3*e,tt(Zn=n,Gn=t)}function ft(n){this._context=n}ft.prototype={_radius:4.5,pointRadius:function(n){return this._radius=n,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._context.closePath(),this._point=NaN},point:function(n,t){switch(this._point){case 0:this._context.moveTo(n,t),this._point=1;break;case 1:this._context.lineTo(n,t);break;default:this._context.moveTo(n+this._radius,t),this._context.arc(n,t,this._radius,0,w)}},result:H};var st,pt,ht,dt,gt,vt=v(),yt={point:H,lineStart:function(){yt.point=mt},lineEnd:function(){st&&St(pt,ht),yt.point=H},polygonStart:function(){st=!0},polygonEnd:function(){st=null},result:function(){var n=+vt;return vt.reset(),n}};function mt(n,t){yt.point=St,pt=dt=n,ht=gt=t}function St(n,t){dt-=n,gt-=t,vt.add(U(dt*dt+gt*gt)),dt=n,gt=t}function Et(){this._string=[]}function xt(n){return"m0,"+n+"a"+n+","+n+" 0 1,1 0,"+-2*n+"a"+n+","+n+" 0 1,1 0,"+2*n+"z"}function Mt(n){return function(t){var r=new _t;for(var i in n)r[i]=n[i];return r.stream=t,r}}function _t(){}function wt(n,t,r){var i=n.clipExtent&&n.clipExtent();return n.scale(150).translate([0,0]),null!=i&&n.clipExtent(null),F(r,n.stream($n)),t($n.result()),null!=i&&n.clipExtent(i),n}function Nt(n,t,r){return wt(n,(function(r){var i=t[1][0]-t[0][0],e=t[1][1]-t[0][1],o=Math.min(i/(r[1][0]-r[0][0]),e/(r[1][1]-r[0][1])),u=+t[0][0]+(i-o*(r[1][0]+r[0][0]))/2,a=+t[0][1]+(e-o*(r[1][1]+r[0][1]))/2;n.scale(150*o).translate([u,a])}),r)}Et.prototype={_radius:4.5,_circle:xt(4.5),pointRadius:function(n){return(n=+n)!==this._radius&&(this._radius=n,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._string.push("Z"),this._point=NaN},point:function(n,t){switch(this._point){case 0:this._string.push("M",n,",",t),this._point=1;break;case 1:this._string.push("L",n,",",t);break;default:null==this._circle&&(this._circle=xt(this._radius)),this._string.push("M",n,",",t,this._circle)}},result:function(){if(this._string.length){var n=this._string.join("");return this._string=[],n}return null}},_t.prototype={constructor:_t,point:function(n,t){this.stream.point(n,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var jt=T(30*j);function Ct(n,t){return+t?function(n,t){function r(i,e,o,u,a,c,l,f,s,p,h,d,g,v){var y=l-i,m=f-e,S=y*y+m*m;if(S>4*t&&g--){var x=u+p,M=a+h,_=c+d,w=U(x*x+M*M+_*_),N=z(_/=w),j=C(C(_)-1)<E||C(o-s)<E?(o+s)/2:A(M,x),b=n(j,N),T=b[0],P=b[1],R=T-i,k=P-e,H=m*R-y*k;(H*H/S>t||C((y*R+m*k)/S-.5)>.3||u*p+a*h+c*d<jt)&&(r(i,e,o,u,a,c,T,P,j,x/=w,M/=w,_,g,v),v.point(T,P),r(T,P,j,x,M,_,l,f,s,p,h,d,g,v))}}return function(t){var i,e,o,u,a,c,l,f,s,p,h,d,g={point:v,lineStart:y,lineEnd:S,polygonStart:function(){t.polygonStart(),g.lineStart=E},polygonEnd:function(){t.polygonEnd(),g.lineStart=y}};function v(r,i){r=n(r,i),t.point(r[0],r[1])}function y(){f=NaN,g.point=m,t.lineStart()}function m(i,e){var o=G([i,e]),u=n(i,e);r(f,s,l,p,h,d,f=u[0],s=u[1],l=i,p=o[0],h=o[1],d=o[2],16,t),t.point(f,s)}function S(){g.point=v,t.lineEnd()}function E(){y(),g.point=x,g.lineEnd=M}function x(n,t){m(i=n,t),e=f,o=s,u=p,a=h,c=d,g.point=m}function M(){r(f,s,l,p,h,d,e,o,i,u,a,c,16,t),g.lineEnd=S,S()}return g}}(n,t):function(n){return Mt({point:function(t,r){t=n(t,r),this.stream.point(t[0],t[1])}})}(n)}var bt=Mt({point:function(n,t){this.stream.point(n*j,t*j)}});function At(n,t,r,i,e){function o(o,u){return[t+n*(o*=i),r-n*(u*=e)]}return o.invert=function(o,u){return[(o-t)/n*i,(r-u)/n*e]},o}function Tt(n,t,r,i,e,o){var u=T(o),a=R(o),c=u*n,l=a*n,f=u/n,s=a/n,p=(a*r-u*t)/n,h=(a*t+u*r)/n;function d(n,o){return[c*(n*=i)-l*(o*=e)+t,r-l*n-c*o]}return d.invert=function(n,t){return[i*(f*n-s*t+p),e*(h-s*n-f*t)]},d}function Pt(n){return function(n){var t,r,i,e,o,u,a,c,l,f,s=150,p=480,h=250,d=0,g=0,v=0,y=0,m=0,S=0,E=1,x=1,M=null,_=mn,C=null,b=wn,A=.5;function T(n){return c(n[0]*j,n[1]*j)}function P(n){return(n=c.invert(n[0],n[1]))&&[n[0]*N,n[1]*N]}function R(){var n=Tt(s,0,0,E,x,S).apply(null,t(d,g)),i=(S?Tt:At)(s,p-n[0],h-n[1],E,x,S);return r=function(n,t,r){return(n%=w)?t||r?V(Q(n),nn(t,r)):Q(n):t||r?nn(t,r):X}(v,y,m),a=V(t,i),c=V(r,a),u=Ct(a,A),k()}function k(){return l=f=null,T}return T.stream=function(n){return l&&f===n?l:l=bt(function(n){return Mt({point:function(t,r){var i=n(t,r);return this.stream.point(i[0],i[1])}})}(r)(_(u(b(f=n)))))},T.preclip=function(n){return arguments.length?(_=n,M=void 0,k()):_},T.postclip=function(n){return arguments.length?(b=n,C=i=e=o=null,k()):b},T.clipAngle=function(n){return arguments.length?(_=+n?Sn(M=n*j):(M=null,mn),k()):M*N},T.clipExtent=function(n){return arguments.length?(b=null==n?(C=i=e=o=null,wn):En(C=+n[0][0],i=+n[0][1],e=+n[1][0],o=+n[1][1]),k()):null==C?null:[[C,i],[e,o]]},T.scale=function(n){return arguments.length?(s=+n,R()):s},T.translate=function(n){return arguments.length?(p=+n[0],h=+n[1],R()):[p,h]},T.center=function(n){return arguments.length?(d=n[0]%360*j,g=n[1]%360*j,R()):[d*N,g*N]},T.rotate=function(n){return arguments.length?(v=n[0]%360*j,y=n[1]%360*j,m=n.length>2?n[2]%360*j:0,R()):[v*N,y*N,m*N]},T.angle=function(n){return arguments.length?(S=n%360*j,R()):S*N},T.reflectX=function(n){return arguments.length?(E=n?-1:1,R()):E<0},T.reflectY=function(n){return arguments.length?(x=n?-1:1,R()):x<0},T.precision=function(n){return arguments.length?(u=Ct(a,A=n*n),k()):U(A)},T.fitExtent=function(n,t){return Nt(T,n,t)},T.fitSize=function(n,t){return function(n,t,r){return Nt(n,[[0,0],t],r)}(T,n,t)},T.fitWidth=function(n,t){return function(n,t,r){return wt(n,(function(r){var i=+t,e=i/(r[1][0]-r[0][0]),o=(i-e*(r[1][0]+r[0][0]))/2,u=-e*r[0][1];n.scale(150*e).translate([o,u])}),r)}(T,n,t)},T.fitHeight=function(n,t){return function(n,t,r){return wt(n,(function(r){var i=+t,e=i/(r[1][1]-r[0][1]),o=-e*r[0][0],u=(i-e*(r[1][1]+r[0][1]))/2;n.scale(150*e).translate([o,u])}),r)}(T,n,t)},function(){return t=n.apply(this,arguments),T.invert=t.invert&&P,R()}}((function(){return n}))()}var Rt=1.340264,kt=-.081106,Ut=893e-6,zt=.003796,Ht=U(3)/2;function Lt(n,t){var r=z(Ht*R(t)),i=r*r,e=i*i*i;return[n*T(r)/(Ht*(Rt+3*kt*i+e*(7*Ut+9*zt*i))),r*(Rt+kt*i+e*(Ut+zt*i))]}function Ot(){return Pt(Lt).scale(177.158)}Lt.invert=function(n,t){for(var r,i=t,e=i*i,o=e*e*e,u=0;u<12&&(o=(e=(i-=r=(i*(Rt+kt*e+o*(Ut+zt*e))-t)/(Rt+3*kt*e+o*(7*Ut+9*zt*e)))*i)*e*e,!(C(r)<1e-12));++u);return[Ht*n*(Rt+3*kt*e+o*(7*Ut+9*zt*e))/T(i),z(R(i)/Ht)]},console.time("draw map"),async function(){var o=await n("../data/world-geojson.json"),u=await g("../data/data_bank_data.csv");function a(n){return n.properties.ADM0_A3_IS}var c=new Map;u.forEach((function(n){"Population growth (annual %)"==n["Series Name"]&&c.set(n["Country Code"],Number(n["2017 [YR2017]"])||0)}));var l={width:.9*window.innerWidth,margin:{top:10,right:10,bottom:10,left:10}};l.boundedWidth=l.width-l.margin.left-l.margin.right;var f={type:"Sphere"},s=Ot().fitWidth(l.boundedWidth,f),p=function(n,t){var r,i,e=4.5;function o(n){return n&&("function"==typeof e&&i.pointRadius(+e.apply(this,arguments)),F(n,r(i))),i.result()}return o.area=function(n){return F(n,r(Pn)),Pn.result()},o.measure=function(n){return F(n,r(yt)),yt.result()},o.bounds=function(n){return F(n,r($n)),$n.result()},o.centroid=function(n){return F(n,r(nt)),nt.result()},o.projection=function(t){return arguments.length?(r=null==t?(n=null,wn):(n=t).stream,o):n},o.context=function(n){return arguments.length?(i=null==n?(t=null,new Et):new ft(t=n),"function"!=typeof e&&i.pointRadius(e),o):t},o.pointRadius=function(n){return arguments.length?(e="function"==typeof n?n:(i.pointRadius(+n),+n),o):e},o.projection(n).context(t)}(s),[[h,d],[v,y]]=p.bounds(f);l.boundedHeight=y,l.height=l.boundedHeight+l.margin.top+l.margin.bottom;var m=t("#wrapper").append("svg").attr("width",l.width).attr("height",l.height),S=m.append("g").style("transform",`translate(${l.margin.left}px, ${l.margin.top})`),E=Array.from(c.values()),x=i(E),M=function(n,t){let r;if(void 0===t)for(const t of n)null!=t&&(r<t||void 0===r&&t>=t)&&(r=t);else{let i=-1;for(let e of n)null!=(e=t(e,++i,n))&&(r<e||void 0===r&&e>=e)&&(r=e)}return r}([-x[0],x[1]]),_=e().domain([-M,0,M]).range(["indigo","white","darkgreen"]),w=(S.append("path").attr("class","earth").attr("d",p(f)),_n()),N=(S.append("path").attr("class","graticule").attr("d",p(w)),S.selectAll(".country").data(o.features).enter().append("path").attr("class","country").attr("d",p).attr("fill",(function(n){var t=c.get(a(n));return void 0===t?"#e2e6e9":_(t)}))),j=l.width<800?l.boundedHeight-30:.5*l.boundedHeight,C=m.append("g").attr("transform",`translate(120, ${j})`),b=(C.append("text").attr("y",-23).attr("class","legend-title").text("Population Growth"),C.append("text").attr("y",-9).attr("class","legend-byline").text("Percent change in 2017"),m.append("defs")),A=_.range().length;b.append("linearGradient").attr("id","legend-gradient").selectAll("stop").data(_.range()).enter().append("stop").attr("stop-color",(function(n){return n})).attr("offset",(function(n,t){return 100*t/(A-1)+"%"})),C.append("rect").attr("x",-60).attr("height",16).attr("width",120).style("fill","url(#legend-gradient)"),C.append("text").attr("class","legend-value").attr("x",70).attr("y",8).text(r(".1f")(M)+"%"),C.append("text").attr("class","legend-value").attr("x",-70).attr("y",8).text(r(".1f")(-M)+"%").style("text-anchor","end"),navigator.geolocation.getCurrentPosition((function(n){const[t,r]=s([n.coords.longitude,n.coords.latitude]);S.append("circle").attr("class","my-location").attr("cx",t).attr("cy",r).attr("r",0).transition().duration(500).attr("r",10)}));var T=t("#tooltip");N.on("mouseenter",(function(n){var t=c.get(a(n));T.select("#country").text((i=n,i.properties.NAME)),T.select("#value").text(r(",.2f")(t||0)+"%");var i;const[e,o]=p.centroid(n),u=e+l.margin.left,f=o+l.margin.top;T.style("transform",`translate(calc(-50% + ${u}px), calc(-100% + ${f}px))`),T.style("opacity",1)})).on("mouseleave",(function(){T.style("opacity",0)}))}().then(()=>console.timeEnd("draw map"));
