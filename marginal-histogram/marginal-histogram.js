import{a as t,b as a}from"../axis-3a2612fb.js";import"../index-54c9ecd2.js";import{R as e,y as r,w as n,x as i,C as s,B as o,D as l,z as h,A as c,j as d,s as p,g as m}from"../precisionRound-f2241ba6.js";import{m as u}from"../mouse-dfac9017.js";import{r as g,d as f,m as y}from"../min-eb5af223.js";import"../line-a0e524d0.js";import{u as x,g as _,t as v,a as b}from"../defaultLocale-6888ceff.js";import{s as w,a as M}from"../sequential-d87bfd9f.js";import{f as H,e as j,l as Y}from"../linear-3681a81c.js";import{h as W,c as N}from"../createDimensions-94cf9eec.js";import{r as D}from"../range-e5956162.js";import{m as $}from"../max-fec1de3e.js";import{D as T}from"../delaunay-5be918bc.js";var k=-.14861,A=1.78277,S=-.29227,q=-.90649,C=1.97294,E=C*q,F=C*A,L=A*S-q*k;function Z(t){if(t instanceof B)return new B(t.h,t.s,t.l,t.opacity);t instanceof e||(t=r(t));var a=t.r/255,n=t.g/255,i=t.b/255,s=(L*i+E*a-F*n)/(L+E-F),o=i-s,l=(C*(n-s)-S*o)/q,h=Math.sqrt(l*l+o*o)/(C*s*(1-s)),c=h?Math.atan2(l,o)*g-120:NaN;return new B(c<0?c+360:c,h,s,t.opacity)}function z(t,a,e,r){return 1===arguments.length?Z(t):new B(t,a,e,null==r?1:r)}function B(t,a,e,r){this.h=+t,this.s=+a,this.l=+e,this.opacity=+r}function R(t){return function a(e){function r(a,r){var n=t((a=z(a)).h,(r=z(r)).h),i=h(a.s,r.s),s=h(a.l,r.l),o=h(a.opacity,r.opacity);return function(t){return a.h=n(t),a.s=i(t),a.l=s(Math.pow(t,e)),a.opacity=o(t),a+""}}return e=+e,r.gamma=a,r}(1)}n(B,z,i(s,{brighter:function(t){return t=null==t?o:Math.pow(o,t),new B(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?l:Math.pow(l,t),new B(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=isNaN(this.h)?0:(this.h+120)*f,a=+this.l,r=isNaN(this.s)?0:this.s*a*(1-a),n=Math.cos(t),i=Math.sin(t);return new e(255*(a+r*(k*n+A*i)),255*(a+r*(S*n+q*i)),255*(a+r*(C*n)),this.opacity)}})),R(c);var G=R(h);Date.prototype.toISOString||x("%Y-%m-%dT%H:%M:%S.%LZ");var I=+new Date("2000-01-01T00:00:00.000Z")?function(t){var a=new Date(t);return isNaN(a)?null:a}:_("%Y-%m-%dT%H:%M:%S.%LZ"),O=(G(z(-100,.75,.35),z(80,1.5,.8)),G(z(260,.75,.35),z(80,1.5,.8)),z());function P(t){(t<0||t>1)&&(t-=Math.floor(t));var a=Math.abs(t-.5);return O.h=360*t-100,O.s=1.5-1.5*a,O.l=.8-.9*a,O+""}function X(t,a,e){t._context.bezierCurveTo((2*t._x0+t._x1)/3,(2*t._y0+t._y1)/3,(t._x0+2*t._x1)/3,(t._y0+2*t._y1)/3,(t._x0+4*t._x1+a)/6,(t._y0+4*t._y1+e)/6)}function J(t){this._context=t}function K(t){return new J(t)}function Q(t,a,e){const r=t[a];t[a]=t[e],t[e]=r}function U(t,a,e){if(r=(t=Float64Array.from(function*(t,a){if(void 0===a)for(let a of t)null!=a&&(a=+a)>=a&&(yield a);else{let e=-1;for(let r of t)null!=(r=a(r,++e,t))&&(r=+r)>=r&&(yield r)}}(t,e))).length){if((a=+a)<=0||r<2)return y(t);if(a>=1)return $(t);var r,n=(r-1)*a,i=Math.floor(n),s=$(function t(a,e,r=0,n=a.length-1,i=H){for(;n>r;){if(n-r>600){const s=n-r+1,o=e-r+1,l=Math.log(s),h=.5*Math.exp(2*l/3),c=.5*Math.sqrt(l*h*(s-h)/s)*(o-s/2<0?-1:1);t(a,e,Math.max(r,Math.floor(e-o*h/s+c)),Math.min(n,Math.floor(e+(s-o)*h/s+c)),i)}const s=a[e];let o=r,l=n;for(Q(a,r,e),i(a[n],s)>0&&Q(a,r,n);o<l;){for(Q(a,o,l),++o,--l;i(a[o],s)<0;)++o;for(;i(a[l],s)>0;)--l}0===i(a[r],s)?Q(a,r,l):(++l,Q(a,l,n)),l<=e&&(r=l+1),e<=l&&(n=l-1)}return a}(t,i).subarray(0,i+1));return s+(y(t.subarray(i+1))-s)*(n-i)}}J.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:X(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,a){switch(t=+t,a=+a,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,a):this._context.moveTo(t,a);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:X(this,t,a)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=a}},console.time("render chart"),async function(){const e=await d("../data/nyc_weather_data.json");function r(t){return t.temperatureMin}function n(t){return t.temperatureMax}var i=v("%Y-%m-%d");function s(t){return i(t.date).setYear(2e3)}var o=N({customDimensions:{histogramMargin:10,histogramHeight:70,legendWidth:250,legendHeight:26}});const l=p("#wrapper").append("svg").attr("width",o.width).attr("height",o.height),h=l.append("g").style("transform",`translate(${o.margin.left}px, ${o.margin.top}px)`);h.append("rect").classed("bounds-background",!0).attr("x",0).attr("width",o.boundedWidth).attr("y",0).attr("height",o.boundedHeight);var c=j([...e.map(r),...e.map(n)]);const g=Y().domain(c).range([0,o.boundedWidth]).nice(),f=Y().domain(c).range([o.boundedHeight,0]).nice();var y=w().domain([v("%m/%d/%Y")("1/1/2000"),v("%m/%d/%Y")("12/31/2000")]).interpolator((function(t){return P(-t)})),x=h.append("g").selectAll(".dot").data(e,t=>t[0]).join("circle").attr("class","dot").attr("cx",t=>g(r(t))).attr("cy",t=>f(n(t))).attr("r",4).style("fill",(function(t){return y(s(t))})),_=W().domain(f.domain()).value(n).thresholds(20),H=_(e),$=Y().domain(j(H,t=>t.length)).range([o.histogramHeight,0]),k=h.append("g").attr("class","right-histogram").style("transform",`translate(\n        ${o.boundedWidth+o.histogramMargin}px, -${o.histogramHeight}px) rotate(90deg)`),A=M().x(t=>f((t.x0+t.x1)/2)).y0(o.histogramHeight).y1(t=>$(t.length)).curve(K),S=(k.append("path").attr("d",t=>A(H)).attr("class","histogram-area"),W().domain(g.domain()).value(r).thresholds(20)),q=S(e),C=Y().domain(j(q,t=>t.length)).range([o.histogramHeight,0]),E=h.append("g").attr("class","top-histogram").style("transform",`translate(0px, ${-o.histogramHeight-o.histogramMargin}px)`),F=M().x(t=>g((t.x0+t.x1)/2)).y0(o.histogramHeight).y1(t=>C(t.length)).curve(K),L=(E.append("path").attr("d",t=>F(q)).attr("class","histogram-area"),T.from(e,t=>g(r(t)),t=>f(n(t))).voronoi());L.xmax=o.boundedWidth,L.ymax=o.boundedHeight,h.selectAll(".voronoi").data(e).enter().append("path").attr("class","voronoi").attr("d",(function(t,a){return L.renderCell(a)}));const Z=t().scale(g),z=(h.append("g").call(Z).style("transform",`translateY(${o.boundedHeight}px)`).append("text").attr("class","x-axis-label").attr("x",o.boundedWidth/2).attr("y",o.margin.bottom-10).html("Minimum Temperature (&deg;F)"),a().scale(f).ticks(4));h.append("g").call(z).append("text").attr("class","y-axis-label").attr("x",-o.boundedHeight/2).attr("y",10-o.margin.left).html("Maximum Temperature (&deg;F)");var B=h.append("g").attr("transform",`translate(\n      ${o.boundedWidth-o.legendWidth-9},\n      ${o.boundedHeight-37})`),R=l.append("defs"),G=D(10).map(t=>t/9);R.append("linearGradient").attr("id","legend-gradient").selectAll("stop").data(G).enter().append("stop").attr("stop-color",t=>P(-t)).attr("offset",t=>100*t+"%");var O=B.append("rect").attr("height",o.legendHeight).attr("width",o.legendWidth).style("fill","url(#legend-gradient)"),X=[v("%m/%d/%Y")("4/1/2000"),v("%m/%d/%Y")("7/1/2000"),v("%m/%d/%Y")("10/1/2000")],J=Y().domain(y.domain()).range([0,o.legendWidth]),Q=B.selectAll(".legend-value").data(X).enter().append("text").attr("class","legend-value").attr("x",J).attr("y",-6).text(b("%b")),V=B.selectAll(".legend-tick").data(X).enter().append("line").attr("class","legend-tick").attr("x1",J).attr("x2",J).attr("y1",6),tt=p("#tooltip"),at=m(".2f"),et=v("%Y-%m-%d"),rt=b("%B %A %-d, %Y"),nt=h.append("g").attr("opacity",0),it=nt.append("circle").attr("class","tooltip-dot");h.selectAll(".voronoi").on("mouseenter",(function(t){tt.select("#min-temperature").text(at(r(t))),tt.select("#max-temperature").text(at(n(t))),tt.select("#date").text(rt(et(t.date)));const a=g(r(t)),e=f(n(t)),i=a+o.margin.left,s=e+o.margin.top-4;tt.style("transform",`translate(calc(-50% + ${i}px), calc(-100% + ${s}px))`).style("opacity",1),it.attr("cx",g(r(t))).attr("cy",f(n(t))).attr("r",7);st.attr("x",a).attr("y",e-5).attr("width",o.boundedWidth+o.histogramMargin+o.histogramHeight-a).attr("height",10),ot.attr("x",a-5).attr("y",-o.histogramMargin-o.histogramHeight).attr("width",10).attr("height",e+o.histogramMargin+o.histogramHeight),nt.style("opacity",1)})).on("mouseleave",(function(){tt.style("opacity",0),nt.style("opacity",0)}));var st=nt.append("rect").attr("class","hover-line"),ot=nt.append("rect").attr("class","hover-line");O.on("mousemove",(function(){const[t]=u(this),a=new Date(J.invert(t-lt)),r=new Date(J.invert(t+lt)),n=(i=[0,t-lt/2,o.legendWidth-lt],U(i,.5,l));var i,l;ht.style("opacity",1).style("transform",`translateX(${n}px)`),ct.text([b("%b %d")(a),b("%b %d")(r)]).join("-"),Q.style("opacity",0),V.style("opacity",0),x.transition().duration(100).style("opacity",.08).attr("r",2);x.filter(c).transition().duration(100).style("opacity",1).attr("r",5);function h(t){return+b("%Y")(t)}function c(t){var e=s(t);return h(a)<2e3?e>=new Date(a).setYear(2e3)||e<=r:h(r)>2e3?e<=new Date(r).setYear(2e3)||e>=a:e>=a&&e<=r}const d=I(J.invert(t));var p=e.filter(c);dt.attr("d",(function(t){return F(S(p))})).attr("fill",y(d)).attr("stroke","white").style("opacity",1),pt.attr("d",(function(t){return A(_(p))})).attr("fill",y(d)).attr("stroke","white").style("opacity",1)})).on("mouseleave",(function(){x.transition().duration(500).style("opacity",1).attr("r",4),ht.style("opacity",0),Q.style("opacity",1),V.style("opacity",1),pt.style("opacity",0),dt.style("opacity",0)}));const lt=.05*o.legendWidth;var ht=B.append("g").attr("opacity",0),ct=(ht.append("rect").attr("class","legend-highlight-bar").attr("width",lt).attr("height",o.legendHeight),ht.append("text").attr("class","legend-highlight-text").attr("x",lt/2).attr("y",-6)),dt=E.append("path"),pt=k.append("path")}().then(()=>console.timeEnd("render chart")).catch(console.error);
