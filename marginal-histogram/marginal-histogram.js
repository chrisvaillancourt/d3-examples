import{a as t,b as n}from"../axis-3a2612fb.js";import"../index-b9fbf715.js";import{R as e,y as a,w as r,x as i,C as o,B as s,D as l,z as c,A as h,a as u,b as d,j as p,s as f,g}from"../precisionRound-200bdab7.js";import{m}from"../mouse-2982b87d.js";import{r as y,d as x,m as _}from"../min-eb5af223.js";import{c as v,l as b,x as w,y as M,a as H,p as j}from"../line-a0e524d0.js";import{a as Y,t as W}from"../defaultLocale-c798c300.js";import{f as N,g as A,h as $,j as k,l as T,e as C}from"../linear-a2cf98e2.js";import{h as D,r as E,c as B}from"../createDimensions-03e199fd.js";import{m as S}from"../max-fec1de3e.js";import{D as F}from"../delaunay-5be918bc.js";var R=-.14861,X=1.78277,q=-.29227,z=-.90649,G=1.97294,L=G*z,P=G*X,I=X*q-z*R;function J(t){if(t instanceof O)return new O(t.h,t.s,t.l,t.opacity);t instanceof e||(t=a(t));var n=t.r/255,r=t.g/255,i=t.b/255,o=(I*i+L*n-P*r)/(I+L-P),s=i-o,l=(G*(r-o)-q*s)/z,c=Math.sqrt(l*l+s*s)/(G*o*(1-o)),h=c?Math.atan2(l,s)*y-120:NaN;return new O(h<0?h+360:h,c,o,t.opacity)}function K(t,n,e,a){return 1===arguments.length?J(t):new O(t,n,e,null==a?1:a)}function O(t,n,e,a){this.h=+t,this.s=+n,this.l=+e,this.opacity=+a}function Q(t){return function n(e){function a(n,a){var r=t((n=K(n)).h,(a=K(a)).h),i=c(n.s,a.s),o=c(n.l,a.l),s=c(n.opacity,a.opacity);return function(t){return n.h=r(t),n.s=i(t),n.l=o(Math.pow(t,e)),n.opacity=s(t),n+""}}return e=+e,a.gamma=n,a}(1)}r(O,K,i(o,{brighter:function(t){return t=null==t?s:Math.pow(s,t),new O(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?l:Math.pow(l,t),new O(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=isNaN(this.h)?0:(this.h+120)*x,n=+this.l,a=isNaN(this.s)?0:this.s*n*(1-n),r=Math.cos(t),i=Math.sin(t);return new e(255*(n+a*(R*r+X*i)),255*(n+a*(q*r+z*i)),255*(n+a*(G*r)),this.opacity)}})),Q(h);var U=Q(c),V=(U(K(-100,.75,.35),K(80,1.5,.8)),U(K(260,.75,.35),K(80,1.5,.8)),K());function Z(t){(t<0||t>1)&&(t-=Math.floor(t));var n=Math.abs(t-.5);return V.h=360*t-100,V.s=1.5-1.5*n,V.l=.8-.9*n,V+""}function tt(t,n,e){t._context.bezierCurveTo((2*t._x0+t._x1)/3,(2*t._y0+t._y1)/3,(t._x0+2*t._x1)/3,(t._y0+2*t._y1)/3,(t._x0+4*t._x1+n)/6,(t._y0+4*t._y1+e)/6)}function nt(t){this._context=t}function et(t){return new nt(t)}function at(t,n,e){const a=t[n];t[n]=t[e],t[e]=a}function rt(t,n,e){if(a=(t=Float64Array.from(function*(t,n){if(void 0===n)for(let n of t)null!=n&&(n=+n)>=n&&(yield n);else{let e=-1;for(let a of t)null!=(a=n(a,++e,t))&&(a=+a)>=a&&(yield a)}}(t,e))).length){if((n=+n)<=0||a<2)return _(t);if(n>=1)return S(t);var a,r=(a-1)*n,i=Math.floor(r),o=S(function t(n,e,a=0,r=n.length-1,i=N){for(;r>a;){if(r-a>600){const o=r-a+1,s=e-a+1,l=Math.log(o),c=.5*Math.exp(2*l/3),h=.5*Math.sqrt(l*c*(o-c)/o)*(s-o/2<0?-1:1);t(n,e,Math.max(a,Math.floor(e-s*c/o+h)),Math.min(r,Math.floor(e+(o-s)*c/o+h)),i)}const o=n[e];let s=a,l=r;for(at(n,a,e),i(n[r],o)>0&&at(n,a,r);s<l;){for(at(n,s,l),++s,--l;i(n[s],o)<0;)++s;for(;i(n[l],o)>0;)--l}0===i(n[a],o)?at(n,a,l):(++l,at(n,l,r)),l<=e&&(a=l+1),e<=l&&(r=l-1)}return n}(t,i).subarray(0,i+1));return o+(_(t.subarray(i+1))-o)*(r-i)}}function it(){var t,n,e,a,r,i=0,o=1,s=$,l=!1;function c(n){return isNaN(n=+n)?r:s(0===e?.5:(n=(a(n)-t)*e,l?Math.max(0,Math.min(1,n)):n))}function h(t){return function(n){var e,a;return arguments.length?([e,a]=n,s=t(e,a),c):[s(0),s(1)]}}return c.domain=function(r){return arguments.length?([i,o]=r,t=a(i=+i),n=a(o=+o),e=t===n?0:1/(n-t),c):[i,o]},c.clamp=function(t){return arguments.length?(l=!!t,c):l},c.interpolator=function(t){return arguments.length?(s=t,c):s},c.range=h(d),c.rangeRound=h(u),c.unknown=function(t){return arguments.length?(r=t,c):r},function(r){return a=r,t=r(i),n=r(o),e=t===n?0:1/(n-t),c}}function ot(t,n){return n.domain(t.domain()).interpolator(t.interpolator()).clamp(t.clamp()).unknown(t.unknown())}function st({data:t,scale:n,accessor:e,dimensions:a,histogramClass:r,chartTransform:i,chartBounds:o,pathClass:s}){var l=D().domain(n.domain()).value(e).thresholds(20)(t),c=T().domain(C(l,t=>t.length)).range([a.histogramHeight,0]),h=o.append("g").attr("class",r).style("transform",i),u=function(){var t=w,n=null,e=v(0),a=M,r=v(!0),i=null,o=H,s=null;function l(l){var c,h,u,d,p,f=l.length,g=!1,m=new Array(f),y=new Array(f);for(null==i&&(s=o(p=j())),c=0;c<=f;++c){if(!(c<f&&r(d=l[c],c,l))===g)if(g=!g)h=c,s.areaStart(),s.lineStart();else{for(s.lineEnd(),s.lineStart(),u=c-1;u>=h;--u)s.point(m[u],y[u]);s.lineEnd(),s.areaEnd()}g&&(m[c]=+t(d,c,l),y[c]=+e(d,c,l),s.point(n?+n(d,c,l):m[c],a?+a(d,c,l):y[c]))}if(p)return s=null,p+""||null}function c(){return b().defined(r).curve(o).context(i)}return l.x=function(e){return arguments.length?(t="function"==typeof e?e:v(+e),n=null,l):t},l.x0=function(n){return arguments.length?(t="function"==typeof n?n:v(+n),l):t},l.x1=function(t){return arguments.length?(n=null==t?null:"function"==typeof t?t:v(+t),l):n},l.y=function(t){return arguments.length?(e="function"==typeof t?t:v(+t),a=null,l):e},l.y0=function(t){return arguments.length?(e="function"==typeof t?t:v(+t),l):e},l.y1=function(t){return arguments.length?(a=null==t?null:"function"==typeof t?t:v(+t),l):a},l.lineX0=l.lineY0=function(){return c().x(t).y(e)},l.lineY1=function(){return c().x(t).y(a)},l.lineX1=function(){return c().x(n).y(e)},l.defined=function(t){return arguments.length?(r="function"==typeof t?t:v(!!t),l):r},l.curve=function(t){return arguments.length?(o=t,null!=i&&(s=o(i)),l):o},l.context=function(t){return arguments.length?(null==t?i=s=null:s=o(i=t),l):i},l}().x(t=>n((t.x0+t.x1)/2)).y0(a.histogramHeight).y1(t=>c(t.length)).curve(et);h.append("path").attr("d",t=>u(l)).attr("class",s)}nt.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:tt(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,n){switch(t=+t,n=+n,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,n):this._context.moveTo(t,n);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:tt(this,t,n)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=n}},console.time("render chart"),async function(){const e=await p("../data/nyc_weather_data.json");function a(t){return t.temperatureMin}function r(t){return t.temperatureMax}var i=Y("%Y-%m-%d");function o(t){return i(t.date).setYear(2e3)}var s=B({customDimensions:{histogramMargin:10,histogramHeight:70,legendWidth:250,legendHeight:26}});const l=f("#wrapper").append("svg").attr("width",s.width).attr("height",s.height),c=l.append("g").style("transform",`translate(${s.margin.left}px, ${s.margin.top}px)`);c.append("rect").classed("bounds-background",!0).attr("x",0).attr("width",s.boundedWidth).attr("y",0).attr("height",s.boundedHeight);var h=C([...e.map(a),...e.map(r)]);const u=T().domain(h).range([0,s.boundedWidth]).nice(),d=T().domain(h).range([s.boundedHeight,0]).nice();var y=function t(){var n=A(it()($));return n.copy=function(){return ot(n,t())},k.apply(n,arguments)}().domain([Y("%m/%d/%Y")("1/1/2000"),Y("%m/%d/%Y")("12/31/2000")]).interpolator((function(t){return Z(-t)})),x=c.append("g").selectAll(".dot").data(e,t=>t[0]).join("circle").attr("class","dot").attr("cx",t=>u(a(t))).attr("cy",t=>d(r(t))).attr("r",4).style("fill",(function(t){return y(o(t))}));st({data:e,scale:d,accessor:r,chartBounds:c,dimensions:s,histogramClass:"right-histogram",pathClass:"histogram-area",chartTransform:`translate(\n        ${s.boundedWidth+s.histogramMargin}px, -${s.histogramHeight}px) rotate(90deg)`}),st({data:e,scale:u,accessor:a,chartBounds:c,dimensions:s,histogramClass:"top-histogram",pathClass:"histogram-area",chartTransform:`translate(0px, ${-s.histogramHeight-s.histogramMargin}px)`});var _=F.from(e,t=>u(a(t)),t=>d(r(t))).voronoi();_.xmax=s.boundedWidth,_.ymax=s.boundedHeight,c.selectAll(".voronoi").data(e).enter().append("path").attr("class","voronoi").attr("d",(function(t,n){return _.renderCell(n)}));const v=t().scale(u),b=(c.append("g").call(v).style("transform",`translateY(${s.boundedHeight}px)`).append("text").attr("class","x-axis-label").attr("x",s.boundedWidth/2).attr("y",s.margin.bottom-10).html("Minimum Temperature (&deg;F)"),n().scale(d).ticks(4));c.append("g").call(b).append("text").attr("class","y-axis-label").attr("x",-s.boundedHeight/2).attr("y",10-s.margin.left).html("Maximum Temperature (&deg;F)");var w=c.append("g").attr("transform",`translate(\n      ${s.boundedWidth-s.legendWidth-9},\n      ${s.boundedHeight-37})`),M=l.append("defs"),H=E(10).map(t=>t/9);M.append("linearGradient").attr("id","legend-gradient").selectAll("stop").data(H).enter().append("stop").attr("stop-color",t=>Z(-t)).attr("offset",t=>100*t+"%");var j=w.append("rect").attr("height",s.legendHeight).attr("width",s.legendWidth).style("fill","url(#legend-gradient)"),N=[Y("%m/%d/%Y")("4/1/2000"),Y("%m/%d/%Y")("7/1/2000"),Y("%m/%d/%Y")("10/1/2000")],D=T().domain(y.domain()).range([0,s.legendWidth]),S=w.selectAll(".legend-value").data(N).enter().append("text").attr("class","legend-value").attr("x",D).attr("y",-6).text(W("%b")),R=w.selectAll(".legend-tick").data(N).enter().append("line").attr("class","legend-tick").attr("x1",D).attr("x2",D).attr("y1",6),X=f("#tooltip"),q=g(".2f"),z=Y("%Y-%m-%d"),G=W("%B %A %-d, %Y"),L=c.append("g").attr("opacity",0),P=L.append("circle").attr("class","tooltip-dot");c.selectAll(".voronoi").on("mouseenter",(function(t,n){X.select("#min-temperature").text(q(a(t))),X.select("#max-temperature").text(q(r(t))),X.select("#date").text(G(z(t.date)));const e=u(a(t)),i=d(r(t)),o=e+s.margin.left,l=i+s.margin.top-4;X.style("transform",`translate(calc(-50% + ${o}px), calc(-100% + ${l}px))`).style("opacity",1),P.attr("cx",u(a(t))).attr("cy",d(r(t))).attr("r",7);I.attr("x",e).attr("y",i-5).attr("width",s.boundedWidth+s.histogramMargin+s.histogramHeight-e).attr("height",10),J.attr("x",e-5).attr("y",-s.histogramMargin-s.histogramHeight).attr("width",10).attr("height",i+s.histogramMargin+s.histogramHeight),L.style("opacity",1)})).on("mouseleave",(function(){X.style("opacity",0),L.style("opacity",0)}));var I=L.append("rect").attr("class","hover-line"),J=L.append("rect").attr("class","hover-line");j.on("mousemove",(function(){const[t]=m(this),n=new Date(D.invert(t-K)),e=new Date(D.invert(t+K)),a=(r=[0,t-K/2,s.legendWidth-K],rt(r,.5,i));var r,i;O.style("opacity",1).style("transform",`translateX(${a}px)`),Q.text([W("%b %d")(n),W("%b %d")(e)]).join("-"),S.style("opacity",0),R.style("opacity",0),x.transition().duration(100).style("opacity",.08).attr("r",2);x.filter((function(t){var a=o(t);return l(n)<2e3?a>=new Date(n).setYear(2e3)||a<=e:l(e)>2e3?a<=new Date(e).setYear(2e3)||a>=n:a>=n&&a<=e})).transition().duration(100).style("opacity",1).attr("r",5);function l(t){return+W("%Y")(t)}})).on("mouseleave",(function(){x.transition().duration(500).style("opacity",1).attr("r",4),O.style("opacity",0),S.style("opacity",1),R.style("opacity",1)}));const K=.05*s.legendWidth;var O=w.append("g").attr("opacity",0),Q=(O.append("rect").attr("class","legend-highlight-bar").attr("width",K).attr("height",s.legendHeight),O.append("text").attr("class","legend-highlight-text").attr("x",K/2).attr("y",-6))}().then(()=>console.timeEnd("render chart")).catch(console.error);
